# Postman 使用指南

## 概述

本文档介绍如何使用 Postman 测试 One-API 接口。

## 环境准备

### 1. 导入文件

1. 导入 Postman Collection：
   - 打开 Postman
   - 点击 "Import" 按钮
   - 选择 `One-API_Collection.json` 文件
   - 点击 "Import" 完成导入

2. 导入环境变量：
   - 点击 "Import" 按钮
   - 选择 `One-API_Environment.json` 文件
   - 点击 "Import" 完成导入

### 2. 配置环境

1. 在右上角选择 "One-API Environment"
2. 确认以下变量已正确设置：
   - `base_url`: `http://47.88.91.79:9999`
   - `phone`: 您的测试手机号（如：13800138000）
   - `phone_verification_code`: 验证码（测试环境固定为：1111）

## 使用流程

### 第一步：用户认证

#### 1. 发送注册验证码
- 选择 "用户管理" → "发送手机验证码"
- 修改 URL 参数：
  - `phone`: 您的手机号
  - `purpose`: `register`
- 点击 "Send" 发送请求
- 验证码会返回在响应中（测试环境固定为 "1111"）

#### 2. 用户注册
- 选择 "用户管理" → "用户注册"
- 修改请求体中的手机号和验证码
- 点击 "Send" 发送请求
- 如果成功，会返回注册成功消息

#### 3. 发送登录验证码
- 选择 "用户管理" → "发送登录验证码"
- 修改 URL 参数：
  - `phone`: 您的手机号
  - `purpose`: `login`
- 点击 "Send" 发送请求

#### 4. 用户登录
- 选择 "用户管理" → "用户登录"
- 修改请求体中的手机号和验证码
- 点击 "Send" 发送请求
- **重要**：登录成功后，系统会自动保存 `token` 和 `user_id` 到环境变量中

### 第二步：测试用户管理功能

#### 1. 获取用户信息
- 选择 "用户管理" → "获取用户信息"
- 点击 "Send" 发送请求
- 验证返回的用户信息是否正确

#### 2. 更新用户信息
- 选择 "用户管理" → "更新用户信息"
- 修改请求体中的信息
- 点击 "Send" 发送请求

#### 3. 用户登出
- 选择 "用户管理" → "用户登出"
- 点击 "Send" 发送请求

### 第三步：测试话题管理功能

#### 1. 获取话题列表
- 选择 "话题管理" → "获取话题列表"
- 点击 "Send" 发送请求
- 查看当前用户的话题列表

#### 2. 创建话题
- 选择 "话题管理" → "创建话题"
- 修改请求体中的话题信息
- 点击 "Send" 发送请求
- 记录返回的话题ID，用于后续测试

#### 3. 发送消息
- 选择 "话题管理" → "发送消息"
- 修改 URL 中的 `{{topic_id}}` 为实际的话题ID
- 修改请求体中的消息内容
- 点击 "Send" 发送请求
- 系统会自动生成AI回复

#### 4. 获取话题消息
- 选择 "话题管理" → "获取话题消息"
- 修改 URL 中的 `{{topic_id}}` 为实际的话题ID
- 点击 "Send" 发送请求
- 查看话题的聊天记录

#### 5. 删除话题
- 选择 "话题管理" → "删除话题"
- 修改 URL 中的 `{{topic_id}}` 为实际的话题ID
- 点击 "Send" 发送请求

### 第四步：测试订阅管理功能

#### 1. 获取订阅列表
- 选择 "订阅管理" → "获取订阅列表"
- 点击 "Send" 发送请求
- 查看当前用户的订阅列表

#### 2. 创建订阅
- 选择 "订阅管理" → "创建订阅"
- 修改请求体中的订阅信息
- 点击 "Send" 发送请求
- 记录返回的订阅ID，用于后续测试

#### 3. 获取订阅文章
- 选择 "订阅管理" → "获取订阅文章"
- 修改 URL 中的 `{{subscription_id}}` 为实际的订阅ID
- 点击 "Send" 发送请求
- 查看订阅的文章列表

#### 4. 取消订阅
- 选择 "订阅管理" → "取消订阅"
- 修改 URL 中的 `{{subscription_id}}` 为实际的订阅ID
- 点击 "Send" 发送请求

#### 5. 重新激活订阅
- 选择 "订阅管理" → "重新激活订阅"
- 修改 URL 中的 `{{subscription_id}}` 为实际的订阅ID
- 点击 "Send" 发送请求

#### 6. 删除订阅
- 选择 "订阅管理" → "删除订阅"
- 修改 URL 中的 `{{subscription_id}}` 为实际的订阅ID
- 点击 "Send" 发送请求

## 环境变量说明

| 变量名 | 说明 | 示例值 |
|--------|------|--------|
| `base_url` | API服务器地址 | `http://47.88.91.79:9999` |
| `token` | 用户访问令牌 | 登录后自动设置 |
| `user_id` | 用户ID | 登录后自动设置 |
| `phone` | 测试手机号 | `13800138000` |
| `phone_verification_code` | 手机验证码 | `1111` |
| `topic_id` | 话题ID | `1` |
| `subscription_id` | 订阅ID | `1` |

## 认证机制

### 双重认证头
所有需要认证的API都需要在请求头中包含两个字段：

1. **Authorization**: 用户的访问令牌
2. **UserID**: 用户的ID

```
Authorization: your_access_token_here
UserID: 123
```

### 自动设置认证信息
登录成功后，Postman会自动设置以下环境变量：
- `token`: 从登录响应中获取的 `access_token`
- `user_id`: 从登录响应中获取的 `id`

## 常见问题

### 1. 认证失败
**问题**: 收到 401 Unauthorized 错误
**解决方案**:
- 确认已成功登录并获取到 token
- 检查请求头中是否包含 Authorization 和 UserID
- 确认 token 和 user_id 的值正确

### 2. 验证码错误
**问题**: 收到 "手机验证码错误或已过期" 错误
**解决方案**:
- 测试环境验证码固定为 "1111"
- 确认手机号格式正确（11位数字）
- 确认 purpose 参数正确（register 或 login）

### 3. 手机号已存在
**问题**: 注册时收到 "手机号已被占用" 错误
**解决方案**:
- 使用不同的手机号进行测试
- 或者先尝试登录，如果手机号已注册

### 4. 资源不存在
**问题**: 收到 404 Not Found 错误
**解决方案**:
- 确认 URL 中的 ID 参数正确
- 确认资源确实存在
- 检查是否有权限访问该资源

### 5. 权限不足
**问题**: 收到 403 Forbidden 错误
**解决方案**:
- 确认用户账户未被禁用
- 确认有足够的权限执行该操作
- 检查用户角色设置

## 测试建议

### 1. 按顺序测试
建议按照文档中的顺序进行测试，确保每个步骤都成功后再进行下一步。

### 2. 记录ID
在创建话题或订阅后，记录返回的ID，用于后续的测试操作。

### 3. 验证响应
每次请求后，检查响应状态码和响应体，确保操作成功。

### 4. 清理数据
测试完成后，可以删除创建的话题和订阅，保持数据整洁。

## 调试技巧

### 1. 查看环境变量
在 Postman 中点击右上角的环境变量图标，可以查看当前设置的所有变量值。

### 2. 使用 Console
在 Postman 中打开 Console（View → Show Postman Console），可以查看详细的请求和响应信息。

### 3. 检查请求头
在发送请求前，检查 Headers 标签页，确认所有必要的请求头都已正确设置。

### 4. 验证响应
在 Tests 标签页中，可以添加测试脚本来验证响应内容。
