import{r as w,b as y,d as q,g as v,U as _,V as A,c as S,a as s,s as U,C as I,k as i,l as V,m as b,W as C,j as $,o as j,p as B,t as F,_ as N}from"./index-Ii46O6WK.js";import{F as u}from"./FormItemInput-BOd5DWe6.js";async function O(m,t){return w(`${y}/phone_verification`,{method:"GET",params:m})}async function P(m,t){return w(`${y}/user/register`,{method:"POST",data:m})}const T={class:"bg-white w-full h-screen flex flex-col"},z={class:"flex login-wrapper"},K={class:"page-main"},L={class:"login-main"},M={class:"main-content"},R={class:"margin-box-row agreement-text flex justify-between"},D={class:"link"},G=q({__name:"CreateAccountView",setup(m){const t=v(60),d=v(!1);let p=null;const g={display_name:"",school:"",college:"",phone:"",code:""},o=_({...g}),r=_({...g}),h=new A({display_name:[{required:!0,message:"请填写姓名"}],school:[{required:!0,message:"请输入学校名称"}],college:[{required:!0,message:"请输入学院名称"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"请填写有效的手机号"},{required:!0,message:"请填写手机号"}],code:[{required:!0,message:"请填写验证码"},{pattern:/^[a-zA-Z0-9]{4}$/,message:"验证码格式不对"}]}),c=l=>{r[l]=""},x=()=>{d.value=!0,t.value=60,p=window.setInterval(()=>{t.value-=1,t.value<=0&&(clearInterval(p),p=null,d.value=!1)},1e3)},E=()=>{Object.assign(o,g)},k=()=>{h.validate({phone:o.phone},(l,e)=>{if(e&&e.phone){r.phone=e.phone[0].message;return}d.value||(x(),O({phone:o.phone,purpose:"register"}).then(n=>{n&&n.success&&C.success("验证码已获取成功")}))})},f=async()=>{try{await h.validate(o);const{code:l,...e}=o;P({phone_verification_code:l,...e}).then(n=>{n&&n.success&&(C.success("注册成功，请进行登录！"),E())})}catch(l){Object.keys(l.fields).forEach(e=>{r[e]=l.fields[e][0].message})}};return(l,e)=>{const n=$("RouterLink");return j(),S("div",T,[s("div",z,[s("div",K,[e[7]||(e[7]=s("div",{class:"header"},"欢迎加入我们",-1)),s("div",L,[s("div",M,[s("div",null,[s("form",{onSubmit:U(f,["prevent"]),onKeypress:I(f,["enter"])},[i(u,{modelValue:o.display_name,"onUpdate:modelValue":e[0]||(e[0]=a=>o.display_name=a),label:"姓名","prop-name":"display_name","error-message":r.display_name,placeholder:"请输入您的姓名",onClearError:c},null,8,["modelValue","error-message"]),i(u,{modelValue:o.school,"onUpdate:modelValue":e[1]||(e[1]=a=>o.school=a),label:"学校","prop-name":"school","error-message":r.school,placeholder:"请输入学校名称",onClearError:c},null,8,["modelValue","error-message"]),i(u,{modelValue:o.college,"onUpdate:modelValue":e[2]||(e[2]=a=>o.college=a),label:"学院","prop-name":"college","error-message":r.college,placeholder:"请输入学院名称",onClearError:c},null,8,["modelValue","error-message"]),i(u,{modelValue:o.phone,"onUpdate:modelValue":e[3]||(e[3]=a=>o.phone=a),label:"手机号","prop-name":"phone","error-message":r.phone,placeholder:"请输入11位手机号",onClearError:c},null,8,["modelValue","error-message"]),i(u,{modelValue:o.code,"onUpdate:modelValue":e[4]||(e[4]=a=>o.code=a),label:"验证码","prop-name":"code","error-message":r.code,placeholder:"请输入验证码",inline:"",onClearError:c},{default:V(()=>[s("div",{class:B(["code-button",{"disabled-btn":d.value}]),onClick:k},F(d.value?t.value+"秒重新发送":"发送验证码"),3)]),_:1},8,["modelValue","error-message"]),s("div",R,[e[6]||(e[6]=s("span",null,[b("我已阅读并同意 "),s("a",{class:"text-1"},"《用户协议》")],-1)),s("span",D,[i(n,{to:"/log-in"},{default:V(()=>e[5]||(e[5]=[b("已有账号，马上登录 ")])),_:1})])]),s("div",{class:"submit-button",onClick:f},"立即注册")],32)])])])])])])}}}),H=N(G,[["__scopeId","data-v-91fb294e"]]);export{H as default};
