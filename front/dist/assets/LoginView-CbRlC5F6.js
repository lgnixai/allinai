import{d as V,U as h,g as f,V as k,c as b,a as o,s as x,C as y,k as u,l as v,E as S,j as E,o as I,p as A,t as L,m as B,W as N,_ as U}from"./index-Ii46O6WK.js";import{u as j}from"./loginState-C2cpEv3v.js";import{F as g}from"./FormItemInput-BOd5DWe6.js";import{a as z,f as q}from"./services-nyJye1FA.js";const F={class:"bg-white w-full h-screen flex flex-col"},K={class:"flex login-wrapper"},M={class:"page-main"},O={class:"login-main"},R={class:"main-content"},T={class:"no-account-link"},$=V({__name:"LoginView",setup(D){const _=j(),t=h({phone:"",code:""}),n=h({phone:"",code:""}),i=f(60),r=f(!1);let c=null;const p=new k({phone:[{pattern:/^1[3-9]\d{9}$/,message:"请填写有效的手机号"},{required:!0,message:"请填写手机号"}],code:[{required:!0,message:"请填写验证码"},{pattern:/^[a-zA-Z0-9]{4}$/,message:"验证码格式不对"}]}),m=a=>{n[a]=""},w=()=>{r.value=!0,i.value=60,c=window.setInterval(()=>{i.value-=1,i.value<=0&&(clearInterval(c),c=null,r.value=!1)},1e3)},C=()=>{p.validate({phone:t.phone},(a,e)=>{if(e&&e.phone){n.phone=e.phone[0].message;return}r.value||(w(),q({phone:t.phone,purpose:"login"}).then(s=>{s&&s.success&&N.success("短信验证码已发送")}))})},d=async()=>{try{await p.validate(t);const{code:a,...e}=t;z({...e,phone_verification_code:a}).then(s=>{if(s&&s.success){const l=JSON.stringify({"chat-token":s.data.access_token,userId:s.data.id});_.setAuthTokenAndUserId(l),S.replace("/")}})}catch(a){Object.keys(a.fields).forEach(e=>{n[e]=a.fields[e][0].message})}};return(a,e)=>{const s=E("RouterLink");return I(),b("div",F,[o("div",K,[o("div",M,[e[3]||(e[3]=o("div",{class:"header"},"登录",-1)),o("div",O,[o("div",R,[o("div",null,[o("form",{onSubmit:x(d,["prevent"]),onKeypress:y(d,["enter"])},[u(g,{modelValue:t.phone,"onUpdate:modelValue":e[0]||(e[0]=l=>t.phone=l),label:"手机号","prop-name":"phone","error-message":n.phone,placeholder:"请输入11位手机号",onClearError:m},null,8,["modelValue","error-message"]),u(g,{modelValue:t.code,"onUpdate:modelValue":e[1]||(e[1]=l=>t.code=l),label:"验证码","prop-name":"code","error-message":n.code,placeholder:"请输入验证码",inline:"",onClearError:m},{default:v(()=>[o("div",{class:A(["code-button",{"disabled-btn":r.value}]),onClick:C},L(r.value?i.value+"秒重新发送":"发送验证码"),3)]),_:1},8,["modelValue","error-message"]),o("div",T,[u(s,{to:"/create-account"},{default:v(()=>e[2]||(e[2]=[B(" 没有账号，立即注册 ")])),_:1})]),o("div",{class:"submit-button",onClick:d},"马上登录")],32)])])])])])])}}}),G=U($,[["__scopeId","data-v-45f4f0a7"]]);export{G as default};
